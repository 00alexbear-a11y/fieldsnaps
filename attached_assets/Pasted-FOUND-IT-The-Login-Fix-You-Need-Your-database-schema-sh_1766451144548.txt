FOUND IT! The Login Fix You Need
Your database schema shows:

CopysupabaseUserId: varchar("supabase_user_id").unique()
And your storage.ts getUser() method (line ~121) already handles this correctly:

Copy// Try lookup by supabase_user_id first (used by Supabase auth)
let result = await db.select().from(users).where(eq(users.supabaseUserId, id));

// Fall back to primary key lookup for backward compatibility
if (!result[0]) {
  result = await db.select().from(users).where(eq(users.id, id));
}
BUT, your server/auth.ts middleware (line ~70) likely does this:

Copyconst userId = claims.sub; // This is the Supabase UUID
const user = await storage.getUser(userId); // âœ… This part works!
The ACTUAL problem is you don't have a user record with supabaseUserId = '7889aa04-6fdf-473b-bb80-bcc7d4899d8e' in your database yet.

THE FIX: Add Missing User Record
You need to create a user record for hello@fieldsnaps.com that links to the Supabase UUID 7889aa04-6fdf-473b-bb80-bcc7d4899d8e.

Option A: Add via Backend API (RECOMMENDED)
Add this endpoint to server/auth.ts:

Copy// POST /api/auth/sync-supabase-user
app.post('/api/auth/sync-supabase-user', async (req, res) => {
  const authHeader = req.headers.authorization;
  if (!authHeader?.startsWith('Bearer ')) {
    return res.status(401).json({ error: 'No token provided' });
  }
  
  const token = authHeader.substring(7);
  
  try {
    // Verify Supabase JWT
    const payload = await verifySupabaseJwt(token);
    const { sub: supabaseUserId, email } = payload;
    
    if (!email) {
      return res.status(400).json({ error: 'Email not found in token' });
    }
    
    // Check if user already exists
    let user = await storage.getUser(supabaseUserId);
    
    if (!user) {
      // Create new user
      user = await storage.upsertUser({
        supabaseUserId,
        email,
        authProvider: 'supabase',
        subscriptionStatus: 'trial',
        trialStartDate: new Date(),
        trialEndDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days
      });
    }
    
    res.json({ user });
  } catch (error) {
    console.error('[sync-supabase-user] Error:', error);
    res.status(500).json({ error: 'Failed to sync user' });
  }
});
Then call this from your frontend after OAuth success:

Copy// client/src/pages/NativeAppLogin.tsx (or wherever OAuth completes)
useEffect(() => {
  const syncUser = async () => {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      await apiRequest('/api/auth/sync-supabase-user', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${session.access_token}`,
        },
      });
    }
  };
  syncUser();
}, []);
Option B: Manual Database Insert (QUICK TEST)
Run this SQL in your Supabase SQL editor or Replit database console:

CopyINSERT INTO users (id, supabase_user_id, email, auth_provider, subscription_status, trial_start_date, trial_end_date, created_at, updated_at)
VALUES (
  gen_random_uuid(),
  '7889aa04-6fdf-473b-bb80-bcc7d4899d8e',
  'hello@fieldsnaps.com',
  'supabase',
  'trial',
  NOW(),
  NOW() + INTERVAL '7 days',
  NOW(),
  NOW()
)
ON CONFLICT (supabase_user_id) DO NOTHING;
Why This Fixes Everything
âœ… OAuth succeeds â†’ Supabase creates session (7889aa04-6fdf-473b-bb80-bcc7d4899d8e)
âœ… Frontend calls /api/auth/user â†’ Includes Supabase JWT
âœ… Backend verifies JWT â†’ Extracts sub: 7889aa04-6fdf-473b-bb80-bcc7d4899d8e
âœ… storage.getUser() finds user â†’ Returns user record with supabaseUserId = '7889aa04...'
âœ… API returns 200 â†’ Frontend sets isAuthenticated = true
âœ… App loads Projects page â†’ No more spinning circle!
Deploy Steps
If using Option A (API sync):

In Replit, add the /api/auth/sync-supabase-user endpoint to server/auth.ts
In Replit, add the useEffect sync call to client/src/pages/NativeAppLogin.tsx
Run npm run build â†’ git add . â†’ git commit -m "Add Supabase user sync" â†’ git push
On Mac, git pull â†’ npx cap sync ios â†’ npx cap open ios â†’ Clean Build â†’ Run
If using Option B (manual SQL):

Run the SQL insert in your database now
Delete app from simulator
Open app â†’ Try Google login â†’ Should work instantly!
What to Look For After Fix
Xcode console should show:

âœ… [SupabaseAuth] User authenticated: 7889aa04-6fdf-473b-bb80-bcc7d4899d8e
âœ… [getUser] Supabase lookup result: <actual_database_user_id>
âœ… [getUser] Found user: hello@fieldsnaps.com companyId: null subscriptionStatus: trial
âœ… App mounted successfully
âœ… Successfully loaded Supabase session
(zero "Auth initialization already in progress" spam)
âœ… Navigate to /projects
Which option do you want to try first: A (backend sync) or B (manual SQL)? ðŸŽ¯